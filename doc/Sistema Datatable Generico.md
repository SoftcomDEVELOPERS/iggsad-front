# üìä Sistema DataTable Gen√©rico - Documentaci√≥n Completa

## üéØ Resumen del Sistema

El sistema DataTable Gen√©rico es una arquitectura modular que permite crear tablas complejas de datos con funcionalidades avanzadas como paginaci√≥n, ordenaci√≥n, selecci√≥n m√∫ltiple, expansi√≥n de filas y acciones personalizadas. Est√° construido sobre PrimeVue DataTable con composables especializados y configuraci√≥n centralizada.

---

## üèóÔ∏è Arquitectura del Sistema

### **Estructura de Archivos**

```
src/
‚îú‚îÄ‚îÄ components/datatable/
‚îÇ   ‚îú‚îÄ‚îÄ DataTableGeneric.vue        # üîß Componente principal reutilizable
‚îÇ   ‚îú‚îÄ‚îÄ ColumnRenderer.vue          # üé® Renderizado inteligente de columnas
‚îÇ   ‚îî‚îÄ‚îÄ TableActions.vue            # ‚ö° Barra de herramientas de la tabla
‚îú‚îÄ‚îÄ composables/datatable/
‚îÇ   ‚îú‚îÄ‚îÄ useTableSorting.js          # üìä L√≥gica de ordenaci√≥n m√∫ltiple
‚îÇ   ‚îú‚îÄ‚îÄ useTablePagination.js       # üìÑ Gesti√≥n de paginaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ useTableSelection.js        # ‚úÖ Selecci√≥n m√∫ltiple inteligente
‚îÇ   ‚îî‚îÄ‚îÄ useTableData.js             # üíæ Gesti√≥n general de datos
‚îú‚îÄ‚îÄ constants/datatableConfig/
‚îÇ   ‚îú‚îÄ‚îÄ commonTableConfig.js        # ‚öôÔ∏è Configuraciones base compartidas
‚îÇ   ‚îî‚îÄ‚îÄ expedientesTableConfig.js   # üìã Configuraci√≥n espec√≠fica de expedientes
‚îú‚îÄ‚îÄ composables/
‚îÇ   ‚îî‚îÄ‚îÄ useExpedientesTable.js      # üß© L√≥gica de negocio espec√≠fica
‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îú‚îÄ‚îÄ datatable.css               # üé® Estilos base del sistema
‚îÇ   ‚îî‚îÄ‚îÄ expedientes-table.css       # üé® Estilos espec√≠ficos de expedientes
‚îî‚îÄ‚îÄ components/expedientes/
    ‚îî‚îÄ‚îÄ ExpedientesTable.vue        # üìù Implementaci√≥n espec√≠fica de expedientes
```

---

## üîß Componentes Principales

### **1. DataTableGeneric.vue - Componente Central**

**Ubicaci√≥n:** `src/components/datatable/DataTableGeneric.vue`

**Responsabilidades:**
- ‚úÖ Renderizado de tabla con configuraci√≥n din√°mica
- ‚úÖ Integraci√≥n de todos los composables del sistema
- ‚úÖ Gesti√≥n de expansi√≥n de filas con template personalizado
- ‚úÖ Columnas de selecci√≥n y acciones din√°micas
- ‚úÖ Configuraci√≥n de paginaci√≥n serverside
- ‚úÖ Sistema de PassThrough para estilos

**Props Principales:**
```javascript
{
  config: Object,           // Configuraci√≥n completa de la tabla
  data: Array,             // Datos a mostrar
  loading: Boolean,        // Estado de carga
  pagination: Object,      // Informaci√≥n de paginaci√≥n
  selectedItems: Array,    // Elementos seleccionados
  expandedRows: Array      // Filas expandidas
}
```

**Eventos Emitidos:**
```javascript
{
  'page',              // Cambio de p√°gina
  'sort',              // Ordenaci√≥n
  'refresh',           // Actualizar datos
  'export',            // Exportar datos
  'action',            // Acciones espec√≠ficas
  'selection-change',  // Cambio de selecci√≥n
  'row-expand',        // Expansi√≥n de fila
  'row-collapse'       // Colapso de fila
}
```

**Composables Integrados:**
```javascript
// Todos los composables est√°n integrados
const { multiSortMeta, onSort } = useTableSorting(props.config, props, emit)
const { selectedPageSize, onPage, onPageSizeChange } = useTablePagination(props.config, props, emit)
const { selectedItems, selectionMode, onSelectionChange } = useTableSelection(props.config, props, emit)
const { expandedRows, allColumns, visibleColumns } = useTableData(props.config, props, emit)
```

### **2. ColumnRenderer.vue - Renderizado Inteligente**

**Ubicaci√≥n:** `src/components/datatable/ColumnRenderer.vue`

**Tipos de Columna Soportados:**
- `expediente` - N√∫mero con badge urgente
- `money` - Formato monetario (‚Ç¨1.234,56)
- `date` - Formato de fecha localizado (DD/MM/YYYY)
- `embargo` - Tag S√≠/No con colores
- `cartera` - Icono + texto de cartera
- `titular` - Nombre con icono de persona
- `tag` - Tags personalizables con severity
- `percentage` - Porcentajes formateados
- `code` - C√≥digo con fuente monoespaciada
- `status` - Estado con iconos y colores
- `text` - Texto por defecto

**Funcionalidades:**
```javascript
// Detecta expedientes urgentes autom√°ticamente
const isUrgent = computed(() => {
  if (props.config.type === 'expediente') {
    return EXPEDIENTES_TABLE_HELPERS.isUrgent(props.data)
  }
  return false
})
```

### **3. TableActions.vue - Barra de Herramientas**

**Ubicaci√≥n:** `src/components/datatable/TableActions.vue`

**Acciones Disponibles:**
- üîÑ **Refrescar** datos
- üìä **Exportar** a Excel
- ‚öôÔ∏è **Configurar** columnas
- üóëÔ∏è **Limpiar** selecci√≥n
- üìß **Email masivo** (espec√≠fico de expedientes)
- üìã **Exportar selecci√≥n** (espec√≠fico de expedientes)

**Funcionalidades de Selecci√≥n:**
```javascript
const hasSelection = computed(() => 
  props.selectedItems && props.selectedItems.length > 0
)
```

---

## üéõÔ∏è Sistema de Configuraci√≥n

### **commonTableConfig.js - Configuraci√≥n Base**

**Ubicaci√≥n:** `src/constants/datatableConfig/commonTableConfig.js`

**Configuraciones Compartidas:**

#### **Paginaci√≥n Com√∫n:**
```javascript
export const COMMON_PAGINATION_CONFIG = {
  enabled: true,
  template: "FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink RowsPerPageDropdown CurrentPageReport",
  currentPageReportTemplate: "Mostrando {first} a {last} de {totalRecords} registros",
  rowsPerPageOptions: [
    { label: '25 filas', value: 25 },
    { label: '50 filas', value: 50 },
    { label: '100 filas', value: 100 },
    { label: '200 filas', value: 200 }
  ],
  defaultPageSize: 50
}
```

#### **PassThrough para Estilos:**
```javascript
export const COMMON_TABLE_PT = {
  root: 'datatable-generic-root',
  header: 'datatable-generic-header',
  body: 'datatable-generic-body',
  row: 'datatable-generic-row'
}
```

#### **Formatters Comunes:**
```javascript
export const COMMON_TABLE_FORMATTERS = {
  formatDate: (d) => new Date(d).toLocaleDateString('es-ES'),
  formatCurrency: (v) => new Intl.NumberFormat('es-ES', { 
    style: 'currency', 
    currency: 'EUR'
  }).format(v),
  formatPercentage: (v) => `${v}%`
}
```

#### **Acciones Comunes:**
```javascript
export const COMMON_TABLE_ACTIONS = {
  view: {
    icon: 'pi pi-eye',
    tooltip: 'Ver detalles',
    severity: 'info',
    enabled: true,
    class: 'action-btn view-btn'
  },
  edit: {
    icon: 'pi pi-pencil',
    tooltip: 'Editar',
    severity: 'secondary',
    enabled: true,
    class: 'action-btn edit-btn'
  },
  delete: {
    icon: 'pi pi-trash',
    tooltip: 'Eliminar',
    severity: 'danger',
    enabled: false,
    class: 'action-btn delete-btn'
  }
}
```

### **expedientesTableConfig.js - Configuraci√≥n Espec√≠fica**

**Ubicaci√≥n:** `src/constants/datatableConfig/expedientesTableConfig.js`

**Estructura Completa:**
```javascript
export const EXPEDIENTES_TABLE_CONFIG = {
  // Metadatos de la tabla
  meta: {
    name: 'expedientes',
    title: 'Expedientes',
    icon: 'pi pi-folder',
    selectable: true,
    expandable: true,
    dataKey: 'numero'
  },
  
  // Columnas con configuraci√≥n detallada
  columns: [
    { 
      field: 'numero', 
      header: 'Expediente', 
      style: { 'min-width': '120px' }, 
      frozen: true,
      visible: true,
      sortable: true,
      type: 'expediente'
    },
    // ... m√°s columnas
  ],
  
  // Acciones espec√≠ficas (hereda de COMMON y personaliza)
  actions: {
    ...COMMON_TABLE_ACTIONS,
    view: {
      ...COMMON_TABLE_ACTIONS.view,
      tooltip: 'Ver expediente'
    },
    edit: {
      ...COMMON_TABLE_ACTIONS.edit,
      tooltip: 'Editar expediente'
    }
  },
  
  // Configuraci√≥n de expansi√≥n
  expansion: {
    enabled: true,
    sections: [
      {
        title: 'Informaci√≥n Procesal',
        fields: [
          { field: 'autos', label: 'Autos' },
          { field: 'fechaPresentacion', label: 'F. Presentaci√≥n', type: 'date' }
        ]
      }
    ]
  },
  
  // Men√∫ contextual (NO se muestra, solo acciones directas)
  contextMenu: [
    { label: 'Ver Detalles', icon: 'pi pi-eye', action: 'view' },
    { label: 'Editar', icon: 'pi pi-pencil', action: 'edit' }
  ]
}
```

---

## üîÑ Composables del Sistema

### **useTableSorting.js - Ordenaci√≥n M√∫ltiple**

**Ubicaci√≥n:** `src/composables/datatable/useTableSorting.js`

**Funcionalidades:**
- ‚úÖ Ordenaci√≥n m√∫ltiple (varios campos simult√°neamente)
- ‚úÖ Persistencia de criterios de ordenaci√≥n
- ‚úÖ Soporte para datos client-side y server-side
- ‚úÖ Gesti√≥n autom√°tica de meta-data de ordenaci√≥n

**API Principal:**
```javascript
const { multiSortMeta, onSort } = useTableSorting(config, props, emit)

// Aplicar ordenaci√≥n program√°tica
applySorting('fechaEnvio', 'desc')
addSortCriteria('principal', 'asc')
clearSort()
```

### **useTablePagination.js - Gesti√≥n de Paginaci√≥n**

**Ubicaci√≥n:** `src/composables/datatable/useTablePagination.js`

**Funcionalidades:**
- ‚úÖ Paginaci√≥n serverside con lazy loading
- ‚úÖ Cambio din√°mico de tama√±o de p√°gina
- ‚úÖ Navegaci√≥n entre p√°ginas con validaci√≥n
- ‚úÖ Informaci√≥n de paginaci√≥n calculada autom√°ticamente

**API Principal:**
```javascript
const {
  selectedPageSize,      // Tama√±o de p√°gina actual
  paginationInfo,        // Info calculada (start, end, total)
  onPage,               // Cambio de p√°gina
  onPageSizeChange      // Cambio de tama√±o
} = useTablePagination(config, props, emit)
```

### **useTableSelection.js - Selecci√≥n Inteligente**

**Ubicaci√≥n:** `src/composables/datatable/useTableSelection.js`

**Funcionalidades:**
- ‚úÖ Selecci√≥n individual y m√∫ltiple
- ‚úÖ Selecci√≥n por criterios (urgentes, por cartera)
- ‚úÖ Estad√≠sticas autom√°ticas de selecci√≥n
- ‚úÖ Resumen financiero para expedientes

**API Principal:**
```javascript
const {
  selectedItems,        // Elementos seleccionados
  selectionMode,        // Modo de selecci√≥n de PrimeVue
  selectionInfo,        // Estad√≠sticas de selecci√≥n
  onSelectionChange,    // Manejador de cambios
  clearSelection,       // Limpiar selecci√≥n
  selectAll,           // Seleccionar todos
  selectUrgent         // Seleccionar urgentes
} = useTableSelection(config, props, emit)
```

### **useTableData.js - Gesti√≥n de Datos**

**Ubicaci√≥n:** `src/composables/datatable/useTableData.js`

**Funcionalidades:**
- ‚úÖ Gesti√≥n de filas expandidas
- ‚úÖ Configuraci√≥n din√°mica de columnas
- ‚úÖ M√©todos de navegaci√≥n de paginaci√≥n
- ‚úÖ Funciones de exportaci√≥n

**API Principal:**
```javascript
const {
  expandedRows,         // Filas expandidas
  allColumns,          // Todas las columnas configuradas
  visibleColumns,      // Solo columnas visibles
  onRowExpand,         // Expandir fila
  onRowCollapse,       // Colapsar fila
  refreshTable,        // Refrescar datos
  exportToExcel        // Exportar a Excel
} = useTableData(config, props, emit)
```

---

## üß© Composables de Negocio

### **useExpedientesTable.js - L√≥gica Espec√≠fica**

**Ubicaci√≥n:** `src/composables/useExpedientesTable.js`

**Responsabilidades:**
- ‚úÖ L√≥gica de negocio espec√≠fica de expedientes
- ‚úÖ Manejo de acciones personalizadas (ver, editar, generar documento)
- ‚úÖ Estad√≠sticas especializadas de expedientes
- ‚úÖ Integraci√≥n con emits espec√≠ficos del componente padre

**Acciones Espec√≠ficas:**
```javascript
const onAction = ({ action, data }) => {
  switch (action) {
    case 'view':
      viewExpediente(data)
      break
    case 'edit':
      editExpediente(data)
      break
    case 'generateDocument':
      generateDocument(data)
      break
    case 'duplicateExpediente':
      duplicateExpediente(data)
      break
  }
}
```

**Estad√≠sticas Especializadas:**
```javascript
const getExpedientesStats = () => ({
  total: expedientes.length,
  totalPrincipal: suma_principal,
  totalIntereses: suma_intereses,
  urgentes: count_urgentes,
  conEmbargos: count_embargos,
  carteras: array_carteras_unicas
})
```

---

## üé® Sistema de Estilos

### **datatable.css - Estilos Base**

**Ubicaci√≥n:** `src/styles/datatable.css`

**Caracter√≠sticas:**
- üé® Usa tokens CSS de iggsad (`--iggsad-*`)
- üé® Headers sticky funcionales
- üé® Efectos hover mejorados
- üé® Filas seleccionadas destacadas
- üé® Animaciones sutiles
- üé® Sistema responsive

**Clases Principales:**
```css
.datatable-generic-container    /* Contenedor principal */
.datatable-generic-header       /* Headers de la tabla */
.datatable-generic-body         /* Cuerpo de la tabla */
.expand-column                  /* Columna de expansi√≥n */
.selection-column               /* Columna de selecci√≥n */
.acciones-column               /* Columna de acciones */
```

**Estilos de Expansi√≥n:**
```css
.expanded-row-content          /* Contenido expandido */
.expansion-grid               /* Grid de secciones */
.detail-section              /* Cada secci√≥n de detalles */
.detail-item                 /* Cada elemento de detalle */
```

### **expedientes-table.css - Estilos Espec√≠ficos**

**Ubicaci√≥n:** `src/styles/expedientes-table.css`

**Caracter√≠sticas:**
- üé® Estilos espec√≠ficos para tipos de celda de expedientes
- üé® Formateo visual de importes monetarios
- üé® Badges y tags especializados
- üé® Indicadores de urgencia

---

## üìù Implementaci√≥n Espec√≠fica: ExpedientesTable.vue

### **Estructura del Componente**

**Ubicaci√≥n:** `src/components/expedientes/ExpedientesTable.vue`

```vue
<template>
  <DataTableGeneric
    :config="tableConfig"
    :data="expedientes"
    :loading="loading"
    :pagination="pagination"
    :selected-items="selectedItems"
    :expanded-rows="expandedRows"
    @page="onPage"
    @sort="onSort"
    @refresh="onRefresh"
    @export="onExport"
    @action="onAction"
    @row-expand="onRowExpand"
    @row-collapse="onRowCollapse"
    @selection-change="onSelectionChange"
  />
</template>

<script setup>
import { computed } from 'vue'
import DataTableGeneric from '@/components/datatable/DataTableGeneric.vue'
import { EXPEDIENTES_TABLE_CONFIG } from '@/constants/datatableConfig/expedientesTableConfig'
import { useExpedientesTable } from '@/composables/useExpedientesTable'

// Props heredadas del componente original
const props = defineProps({
  expedientes: { type: Array, default: () => [] },
  loading: { type: Boolean, default: false },
  pagination: { type: Object, required: true }
})

// Emits espec√≠ficos
const emit = defineEmits([
  'page', 'sort', 'refresh', 'export', 
  'row-expand', 'selection-change'
])

// Integraci√≥n con composable espec√≠fico
const {
  selectedItems, expandedRows, onPage, onSort,
  onRefresh, onExport, onAction, onSelectionChange,
  getExpedientesStats
} = useExpedientesTable(props, emit)

// Configuraci√≥n reactiva
const tableConfig = computed(() => EXPEDIENTES_TABLE_CONFIG)
</script>
```

---

## üöÄ Gu√≠a de Implementaci√≥n

### **Crear Nueva Tabla (Ejemplo: ClientesTable)**

#### **1. Crear Configuraci√≥n**
```javascript
// constants/datatableConfig/clientesTableConfig.js
export const CLIENTES_TABLE_CONFIG = {
  meta: {
    name: 'clientes',
    title: 'Gesti√≥n de Clientes',
    icon: 'pi pi-users',
    selectable: true,
    expandable: false,
    dataKey: 'id'
  },
  
  columns: [
    { field: 'codigo', header: 'C√≥digo', type: 'code', visible: true },
    { field: 'nombre', header: 'Nombre', type: 'person', visible: true },
    { field: 'email', header: 'Email', type: 'text', visible: true },
    { field: 'deudaTotal', header: 'Deuda', type: 'money', visible: true }
  ],
  
  actions: {
    ...COMMON_TABLE_ACTIONS,
    view: { ...COMMON_TABLE_ACTIONS.view, tooltip: 'Ver cliente' }
  },
  
  pagination: COMMON_PAGINATION_CONFIG,
  pt: COMMON_TABLE_PT,
  classes: COMMON_TABLE_CLASSES
}
```

#### **2. Crear Composable Espec√≠fico**
```javascript
// composables/useClientesTable.js
export function useClientesTable(props, emit) {
  const selectedItems = ref([])
  
  const onAction = ({ action, data }) => {
    switch (action) {
      case 'view':
        viewCliente(data)
        break
      case 'edit':
        editCliente(data)
        break
    }
  }
  
  const viewCliente = (cliente) => {
    emit('view-cliente', cliente)
  }
  
  return {
    selectedItems,
    onAction,
    viewCliente
  }
}
```

#### **3. Crear Componente**
```vue
<!-- components/clientes/ClientesTable.vue -->
<template>
  <DataTableGeneric
    :config="tableConfig"
    :data="clientes"
    :loading="loading"
    :pagination="pagination"
    @action="onAction"
  />
</template>

<script setup>
import { computed } from 'vue'
import DataTableGeneric from '@/components/datatable/DataTableGeneric.vue'
import { CLIENTES_TABLE_CONFIG } from '@/constants/datatableConfig/clientesTableConfig'
import { useClientesTable } from '@/composables/useClientesTable'

const props = defineProps({
  clientes: { type: Array, default: () => [] },
  loading: { type: Boolean, default: false },
  pagination: { type: Object, required: true }
})

const emit = defineEmits(['view-cliente'])

const { onAction } = useClientesTable(props, emit)
const tableConfig = computed(() => CLIENTES_TABLE_CONFIG)
</script>
```

---

## ‚úÖ Estado Actual del Sistema

### **Funcionalidades Completadas**
- ‚úÖ **DataTableGeneric** integra todos los composables
- ‚úÖ **Expansi√≥n de filas** funciona con template personalizado
- ‚úÖ **Botones de acciones** (Ver/Editar) aparecen correctamente
- ‚úÖ **Configuraci√≥n centralizada** completamente modular
- ‚úÖ **Estilos unificados** con tokens CSS
- ‚úÖ **Sistema de tipos de columna** extensible
- ‚úÖ **ExpedientesTable** funciona como referencia

### **Pendientes**
- ‚ö†Ô∏è **Paginador**: Implementar lazy loading real
- üìù **Nuevos tipos de columna**: rating, progress, etc.
- üîç **B√∫squeda avanzada**: Filtros integrados
- üìä **Gr√°ficos inline**: M√©tricas visuales en columnas

---

## üîç Referencias R√°pidas

### **Archivos Clave para Modificar**
- **A√±adir nueva tabla**: `constants/datatableConfig/` + `composables/`
- **Nuevo tipo de columna**: `ColumnRenderer.vue`
- **Nueva acci√≥n**: `COMMON_TABLE_ACTIONS` en `commonTableConfig.js`
- **Estilos globales**: `styles/datatable.css`
- **Estilos espec√≠ficos**: `styles/[tabla]-table.css`

### **Composables Disponibles**
- `useTableSorting` ‚Üí Ordenaci√≥n m√∫ltiple
- `useTablePagination` ‚Üí Paginaci√≥n serverside
- `useTableSelection` ‚Üí Selecci√≥n inteligente
- `useTableData` ‚Üí Gesti√≥n general de datos
- `useExpedientesTable` ‚Üí L√≥gica espec√≠fica de expedientes

### **Configuraciones Base**
- `COMMON_TABLE_ACTIONS` ‚Üí Acciones reutilizables
- `COMMON_TABLE_FORMATTERS` ‚Üí Formatters compartidos
- `COMMON_PAGINATION_CONFIG` ‚Üí Configuraci√≥n de paginaci√≥n
- `COMMON_TABLE_PT` ‚Üí PassThrough para estilos

---

*Documentaci√≥n generada para el Sistema de Gesti√≥n Procesal | DataTable Gen√©rico v1.0*